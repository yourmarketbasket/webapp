<div class="container">
    <div class="row mb-5 p-5">
        <div *ngIf="advancedActionAllowed" class="table-responsive">
            <div class="input-group input-group-lg mb-3">
                <input type="text" class="form-control" [(ngModel)]="searchTerm" (input)="searchProducts()" placeholder="Search products..." aria-label="Search products">
                <button class="btn btn-outline-success" type="button" id="button-addon2">
                    <i class="fa fa-search"></i>
                </button>
            </div>
            <span class="fs-10 badge bg-success-transparent rounded-pill float-right" *ngIf="searchTerm">Search phrase <span class="text-danger">{{searchTerm}}</span> returned {{paginatedProducts.length}} results</span>

            <!-- Table with responsive behavior -->
            <div class="table-responsive mb-2">
                <table class="table table-sm text-nowrap">
                    <thead class="table-success">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">User</th>
                            <th scope="col">Brand</th>
                            <th scope="col">Category</th>
                            <th scope="col">Model</th>
                            <th scope="col">BP</th>
                            <th scope="col">SP</th>
                            <th scope="col">Quantity</th>
                            <th scope="col">Posted</th>
                            <th scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Loop through products when advanced action is allowed -->
                        <tr *ngFor="let product of paginatedProducts; let i=index">
                            <td>{{ (currentPage * pageSize) + i + 1 }}</td>
                            <td scope="row">
                                <div class="d-flex align-items-center">
                                    <span class="avatar avatar-lg me-2 online">
                                        <img [src]="product.avatar" alt="Product Image">
                                    </span>
                                    {{ product.name }}
                                </div>
                            </td>
                            <td>{{ product.brand }}</td>
                            <td>{{ product.category }}</td>
                            <td>{{ product.model }}</td>
                            <td>{{ product.bp }}</td>
                            <td>{{ product.sp }}</td>
                            <td>{{ product.quantity }}</td>
                            <td>{{ product.createdAt | nireadabledate }}</td>
                            <td>
                                <div class="d-flex flex-wrap justify-content-center">
                                    <button *ngIf="!product.approved" class="btn btn-outline-success mb-1 mb-md-0" (click)="approveListedItem(product._id)">
                                        <i class="fa fa-check"></i>
                                    </button>
                                    <button class="btn btn-outline-danger" (click)="rejectListedItem(product._id)">
                                        <i class="fa fa-close"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <nav aria-label="Page navigation" class="pagination-style-1">
                <ul class="pagination mb-0 flex-wrap">
                    <!-- First Page -->
                    <li class="page-item" [class.disabled]="currentPage === 0">
                        <a class="page-link" href="javascript:void(0);" (click)="changePage(0)">
                            <i class="ri-arrow-left-s-line align-middle"></i> First
                        </a>
                    </li>

                    <!-- Previous Page -->
                    <li class="page-item" [class.disabled]="currentPage === 0">
                        <a class="page-link" href="javascript:void(0);" (click)="changePage(currentPage - 1)">
                            <i class="ri-arrow-left-s-line align-middle"></i> Prev
                        </a>
                    </li>

                    <!-- Visible Page Numbers -->
                    <li class="page-item" *ngIf="currentPage > 1">
                        <a class="page-link" href="javascript:void(0);" (click)="changePage(currentPage - 1)">
                            <i class="bi bi-three-dots"></i>
                        </a>
                    </li>

                    <li class="page-item" *ngFor="let page of visiblePageNumbers" [class.active]="page === currentPage">
                        <a class="page-link" href="javascript:void(0);" (click)="changePage(page)">{{ page + 1 }}</a>
                    </li>

                    <li class="page-item" *ngIf="currentPage < totalPages - 2">
                        <a class="page-link" href="javascript:void(0);" (click)="changePage(totalPages - 1)">
                            <i class="bi bi-three-dots"></i>
                        </a>
                    </li>

                    <!-- Next Page -->
                    <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
                        <a class="page-link" href="javascript:void(0);" (click)="changePage(currentPage + 1)">
                            <i class="ri-arrow-right-s-line align-middle"></i> Next
                        </a>
                    </li>

                    <!-- Last Page -->
                    <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
                        <a class="page-link" href="javascript:void(0);" (click)="changePage(totalPages - 1)">
                            <i class="ri-arrow-right-s-line align-middle"></i> Last
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Image Viewing Section -->
            <div *ngIf="images && images.length > 0">
                <div *ngIf="loading" class="progress-spinner">
                    <mat-spinner strokeWidth="2"></mat-spinner>
                </div>

                <!-- Display the image when not loading -->
                <div (mouseenter)="showOverlay = true" (mouseleave)="showOverlay = false" class="img-container">
                    <img class="product-image" [src]="images[currentIndex]" alt="" (load)="onImageLoad()">
                    <div class="overlay" *ngIf="showOverlay && !selectedProductVerified">
                        <span class="product_description">
                            {{ selectedProductDescription }}
                        </span>
                        <div class="overlay-buttons">
                            <button mat-flat-button class="green-button" (click)="approveListedItem(selectedProductId)">Approve</button>
                            <button mat-flat-button class="red-button" (click)="rejectListedItem(selectedProductId)">Reject</button>
                        </div>
                    </div>
                </div>

                <div class="product-image-nav-buttons" *ngIf="!loading">
                    <button mat-flat-button (click)="previousImage()" [disabled]="loading || currentIndex === 0">Previous</button>
                    <button mat-flat-button (click)="nextImage()" [disabled]="loading || currentIndex === images.length - 1">Next</button>
                </div>
            </div>
        </div>
    </div>
</div>
