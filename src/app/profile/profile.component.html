<!-- Full-width Container for the Layout -->
<div class="container-fluid my-4">
  <div class="row">
    <!-- First Major Column (25% width) -->
    <div class="col-md-3">
      <div class="card p-3 mb-4">
        <div class="d-flex flex-column align-items-center">
          <img [src]="avatar" alt="Avatar" class="rounded-circle img-fluid shadow" style="width: 150px; height: 150px;">
          <div class="d-flex justify-content-center w-100">
           <div class="col-xl-4">
            <!-- Approved Toggle (Primary, Success) -->
            <div class="toggle toggle-success on mb-0" appToggleBtn>
                <span></span>
            </div>
            </div>
            <div class="col-xl-4">
                <!-- Verified Toggle (Secondary, Warning) -->
                <div class="toggle toggle-primary on mb-3" appToggleBtn>
                    <span></span>
                </div>
            </div>

          </div>
        </div>
        <div class="mt-3">
          <span class="text-center text-primary">{{name}}</span>
          <div class="d-flex justify-content-center align-items-center">
            <span [innerHTML]="rating | nipipe"></span>
          </div>
          <div class="text-muted mt-2">
            <p><mat-icon>phone</mat-icon> ({{zipcode}}) {{phone}}</p>
            <p><mat-icon>location_city</mat-icon> {{address}}, {{city}}</p>
            <p *ngIf="active"><mat-icon>card_membership</mat-icon> Member for {{calculateTimeDifference(registered)}}</p>
            <p><mat-icon>brightness_1</mat-icon> <span class="badge rounded-pill" [ngClass]="{'bg-success': active, 'bg-secondary': !active}">{{active ? "Active" : "Dormant"}}</span></p>
          </div>
          <button class="btn btn-outline-primary w-100 mt-3"><mat-icon>edit</mat-icon> Edit Info</button>
        </div>
      </div>

      <!-- Map Section -->
      <div class="card p-3">
        <iframe *ngIf="mapurl && location" [src]="mapurl" class="w-100 shadow-sm" style="height: 300px; border: none;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
    </div>

    <!-- Second Major Column (75% width) -->
    <div class="col-md-9">
      <div class="row">
        <!-- First Sub-Column -->
        <div class="col-md-6 mb-4">
          <div class="card mb-4 shadow-sm">
            <canvas #chartCanvas></canvas>
          </div>
          <div class="card">
            <h4 class="text-primary p-3">My Orders</h4>
            <mat-table [dataSource]="dataSource" class="table">
              <!-- Transaction ID Column -->
              <ng-container matColumnDef="transactionId">
                <mat-header-cell *matHeaderCellDef> TID </mat-header-cell>
                <mat-cell *matCellDef="let data"> {{data.transactionID}} </mat-cell>
              </ng-container>

              <!-- Payment Column -->
              <ng-container matColumnDef="payment">
                <mat-header-cell *matHeaderCellDef> Payment </mat-header-cell>
                <mat-cell *matCellDef="let data">
                  <span class="badge rounded-pill" [ngClass]="{
                    'bg-danger': data.paymentStatus === 'Failed',
                    'bg-success': data.paymentStatus === 'Completed',
                    'bg-warning': data.paymentStatus === 'Pending'
                  }">
                    {{data.paymentStatus.toUpperCase()}}
                  </span>
                </mat-cell>
              </ng-container>

              <!-- Order Status Column -->
              <ng-container matColumnDef="orderStatus">
                <mat-header-cell *matHeaderCellDef> Order Status </mat-header-cell>
                <mat-cell *matCellDef="let data">
                  <span class="badge rounded-pill bg-info">{{data.overallStatus.toUpperCase()}}</span>
                </mat-cell>
              </ng-container>

              <!-- Total Column -->
              <ng-container matColumnDef="total">
                <mat-header-cell *matHeaderCellDef> Total </mat-header-cell>
                <mat-cell *matCellDef="let data"> {{data.amount | currency: ' '}} </mat-cell>
              </ng-container>

              <!-- Header Row -->
              <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>

              <!-- Data Row -->
              <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
            </mat-table>
            <mat-paginator [pageSizeOptions]="[5, 10]" showFirstLastButtons></mat-paginator>
          </div>
        </div>

        <!-- Second Sub-Column -->
        <div class="col-md-6 mb-4">
          <div class="card mb-4 shadow-sm">
            <canvas #piechart></canvas>
          </div>
          <div class="card">
            <h4 class="text-primary p-3">Stores</h4>
            <table class="table">
              <thead>
                <tr>
                  <th>Store Name</th>
                  <th>Location</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let store of stores">
                  <td>{{store.name}}</td>
                  <td>{{store.location}}</td>
                  <td>
                    <span class="badge rounded-pill" [ngClass]="{
                      'bg-success': store.status === 'Open',
                      'bg-secondary': store.status === 'Closed',
                      'bg-warning': store.status === 'Pending'
                    }">
                      {{store.status}}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>