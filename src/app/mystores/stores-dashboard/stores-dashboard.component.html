
<div class="container-fluid">
  <!-- Main Column -->
  <div class="row">
    <div class="col-12">
      
      <!-- First Row -->
      <div class="row">
          <div class="col-md-6 col-lg-3 col-xl-3">
              <div class="card custom-card overflow-hidden">
                <div class="card-body p-0">
                  <div class="mb-2 p-3 pb-0">
                    <div class="flex-fill fs-15">Total Sales</div>
                </div>
                <div class="d-flex align-items-center ps-3">
                    <div class="flex-fill">
                        <div class="fs-25 fw-normal mb-2">$170k+</div>
                        <p class="mb-0">
                            <i class="ri-arrow-up-line text-primary fs-15 align-middle"></i>
                            <span  class="text-primary fs-12"> 26.35% last month</span>
                        </p>
                    </div>
                    <div style="height:100px;">
                      <div class="crm-card-chart" id="lineChartWithoutLabels"
                          appLineChart
                          [keys]="['Jan', 'Feb', 'Mar', 'Apr']"
                          [seriesData]="[{ name: 'Revenue', data: [120, 150, 170, 200] }]"
                          [chartID]="'lineChartWithoutLabels'"
                          [showLegend]="false" 
                          [hideAxisLabels]="false" 
                          [showLabels]="false"> 
                      </div>
                    </div>
                </div>
                </div>
              </div>
          </div>
          <div class="col-md-6 col-lg-3 col-xl-3">
              <div class="card custom-card overflow-hidden">
                  <div class="card-body p-0">
                      <div class="mb-2 p-3 pb-0">
                          <div class="flex-fill fs-15">Revenue Generated</div>
                      </div>
                      <div class="d-flex align-items-center ps-3">
                          <div class="flex-fill">
                              <div class="fs-25 fw-normal mb-2">$115k</div>
                              <p class="mb-0">
                                  <i class="ri-arrow-down-line text-danger fs-15 align-middle"></i>
                                  <span  class="text-danger fs-12"> 11.35% last month</span>
                              </p>
                          </div>
                          <div style="height:100px;">
                            <div class="crm-card-chart" id="revenueChartWithoutLabels"
                                appLineChart
                                [keys]="['Jan', 'Feb', 'Mar', 'Apr']"
                                [seriesData]="[{ name: 'Revenue', data: [120, 150, 170, 200] }]"
                                [chartID]="'revenueChartWithoutLabels'"
                                [showLegend]="false" 
                                [hideAxisLabels]="false" 
                                [showLabels]="false"> 
                            </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          <div class="col-md-6 col-lg-3 col-xl-3">
              <div class="card custom-card overflow-hidden">
                  <div class="card-body p-0">
                      <div class="mb-2 p-3 pb-0">
                          <div class="flex-fill fs-15">New Customers</div>
                      </div>
                      <div class="d-flex align-items-center ps-3">
                          <div class="flex-fill">
                              <div class="fs-25 fw-normal mb-2">150+</div>
                              <p class="mb-0">
                                  <i class="ri-arrow-up-line text-secondary fs-15 align-middle"></i>
                                  <span  class="text-secondary fs-12"> 26.35% last month</span>
                              </p>
                          </div>
                          <div style="height:100px;">
                            <div class="crm-card-chart" id="customerChartWithoutLabels"
                                appLineChart
                                [keys]="['Jan', 'Feb', 'Mar', 'Apr']"
                                [seriesData]="[{ name: 'Revenue', data: [120, 150, 170, 200] }]"
                                [chartID]="'customerChartWithoutLabels'"
                                [showLegend]="false" 
                                [hideAxisLabels]="false" 
                                [showLabels]="false"> 
                            </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          <div class="col-md-6 col-lg-3 col-xl-3">
              <div class="card custom-card overflow-hidden">
                  <div class="card-body p-0">
                      <div class="mb-2 p-3 pb-0">
                          <div class="flex-fill fs-15">Orders Received</div>
                      </div>
                      <div class="d-flex align-items-center ps-3">
                          <div class="flex-fill">
                              <div class="fs-25 fw-normal mb-2">30k+</div>
                              <p class="mb-0">
                                  <i class="ri-arrow-up-line text-info fs-15 align-middle"></i>
                                  <span  class="text-info fs-12"> 16.35% last month</span>
                              </p>
                          </div>
                          <div style="height:100px;">
                            <div class="crm-card-chart" id="ordersChartWithoutLabels"
                                appLineChart
                                [keys]="['Jan', 'Feb', 'Mar', 'Apr']"
                                [seriesData]="[{ name: 'Revenue', data: [120, 150, 170, 200] }]"
                                [chartID]="'ordersChartWithoutLabels'"
                                [showLegend]="false" 
                                [hideAxisLabels]="false" 
                                [showLabels]="false"> 
                            </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      <!-- second row -->
      <div class="row mb-3">
        <!-- Card container -->
        <div class="col-12">
          <div class="nicard">
            <div class="p-2 d-flex justify-content-between align-items-center">
              <!-- Select store dropdown -->
              <div class="col-md-3 col-xl-3">
                <mdb-form-control class="w-100" *ngIf="stores.length > 0">
                  <mdb-select
                    label="'Choose store'"
                    (valueChange)="setActiveStoreID($event._id, $event.storename)"
                  >
                    <mdb-option *ngFor="let store of stores" [value]="store">
                      {{ store?.storename }}
                    </mdb-option>
                  </mdb-select>
                  <label mdbLabel class="form-label">Choose store</label>
                </mdb-form-control>
              </div>
              <!-- Store name display -->
              <div class="col-md-auto col-xl-auto">
                <span>
                  <i class="ri-store-2-line"></i>
                  {{ activeStore?.toUpperCase() ?? storename?.toUpperCase() }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      
      
      <!-- Second Row -->
      <div class="row g-3">
        <!-- Products Section -->
        <div class="col-7">
          <div class="row">
            <!-- No Products Card -->
            <div class="col-6 p-1" *ngIf="!products || products.length === 0">
              <div class="card d-flex w-100 flex-column justify-content-center align-items-center" style="height: 100px;">
                <div class="card-body text-center">
                  No products found
                </div>
              </div>
            </div>

            <!-- Products Available -->
            <div *ngIf="products && products.length > 0" class="col-12">
              <div class="nicard p-1">
                <!-- Filter Input -->
                <div class="input-group mb-3">
                  <input 
                    type="text" 
                    class="form-control rounded-1" 
                    placeholder="Type the name, brand, or any verifier" 
                    (keyup)="applyFiltertoProducts($event)" 
                    #input />
                  <button class="btn btn-outline-primary" (click)="applyFiltertoProducts($event)">
                    <i class="bi bi-search"></i>
                  </button>
                </div>

                <!-- Product Count -->
                <div class="d-flex justify-content-end mb-2">
                  <small>A total of {{ products.length }} products found</small>
                </div>

                <!-- Products Table -->
                <div class="table-responsive">
                  <table class="table text-nowrap">
                    <thead class="table-success">
                      <tr>
                        <th>Name</th>
                        <th>Brand</th>
                        <th>Category</th>
                        <th>Sub-category</th>
                        <th>Model</th>
                        <th>BP</th>
                        <th>SP</th>
                        <!-- <th>Qtty</th>
                        <th></th> -->


                        <!-- <th>QTTY</th> -->
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let product of paginatedProducts">
                        <td>{{ product.name }}</td>
                        <td>{{ product.brand }}</td>
                        <td>{{ product.category }}</td>
                        <td>{{ product.subcategory }}</td>
                        <td>{{ product.model }}</td>
                        <td>{{ product.bp | abbreviateNumber }}</td>
                        <td>{{ product.sp | abbreviateNumber }}</td>
                        <!-- <td>{{ product.quantity | abbreviateNumber }}</td> -->
                        <!-- <td>
                          <div class="d-flex gap-2">
                            <button (click)="editProduct(product._id)" class="btn btn-sm btn-outline-primary">
                              <i class="fa fa-pen"></i>
                            </button>
                            <button (click)="deleteProduct(product._id, product.name, product.model)" class="btn btn-sm btn-outline-danger">
                              <i class="fa fa-trash"></i>
                            </button>
                          </div>
                        </td> -->
                      </tr>
                    </tbody>
                  </table>
                  <!-- Pagination -->
                  <nav aria-label="Page navigation mt-1">
                    <ul class="pagination">
                      <li class="page-item" [class.disabled]="currentProductsPage === 1">
                        <a class="page-link" (click)="changeProductsPage('prev')">
                          <i class="bi bi-arrow-left"></i>
                        </a>
                      </li>
                      <li class="page-item" *ngFor="let page of productPages" [class.active]="page === currentProductsPage">
                        <a class="page-link" (click)="goToProductsPage(page)">{{ page }}</a>
                      </li>
                      <li class="page-item" [class.disabled]="currentProductsPage === productsTotalPages">
                        <a class="page-link" (click)="changeProductsPage('next')">
                          <i class="bi bi-arrow-right"></i>
                        </a>
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>

              <!-- Map Card -->
              <div class="card mt-3">
                <div class="card-body p-0">
                  <iframe 
                    *ngIf="mapurl" 
                    [src]="mapurl" 
                    class="w-100" 
                    style="border: 0; height: 300px;" 
                    allowfullscreen 
                    loading="lazy" 
                    referrerpolicy="no-referrer-when-downgrade">
                  </iframe>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Orders Section -->
        <div class="col-5">
          <div class="row">
            <!-- No Orders Card -->
            <div class="col-12 p-1" *ngIf="!orders || orders.length === 0">
              <div class="card " style="height: 100px;">
                <div class="card-body text-center d-flex flex-column justify-content-center align-items-center">
                  <button *ngIf="!orders || orders.length!==0" class="btn btn-primary-light" type="button" disabled>
                      <span class="spinner-border spinner-border-sm align-middle" role="status" aria-hidden="true"></span>
                      Loading...
                  </button>
                  <span *ngIf="orders.length===0" >
                    No Orders Found!
                  </span>
                </div>
              </div>
            </div>

            <!-- Orders Available -->
            <div class="col-12 ps-2" *ngIf="orders && orders.length > 0">
              <div class="nicard p-1">
                <!-- Filter Input -->
                <div class="input-group mb-3">
                  <input 
                    type="text" 
                    class="form-control rounded-1" 
                    placeholder="Search {{ storename }} Order(s)" 
                    (keyup)="applyFiltertoOrders($event)" 
                    #input />
                  <button class="btn btn-outline-primary" (click)="applyFiltertoOrders($event)">
                    <i class="bi bi-search"></i>
                  </button>
                </div>

                <!-- Orders Count -->
                <div class="d-flex justify-content-end mb-2">
                  <small>{{ orders.length }} Store order(s) found</small>
                </div>

                <!-- Orders Table -->
                <div class="table-responsive">
                  <table class="table">
                    <thead class="table-primary">
                      <tr>
                        <th>Client</th>
                        <th>TID</th>
                        <th>Payment</th>
                        <th>Status</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let order of paginatedOrders">
                        <td>{{ order.buyername | capitalize }}</td>
                        <td>{{ order.transactionID }}</td>
                        <td>
                          <span *ngIf="order.paymentStatus === 'Completed'" class="badge bg-success-transparent">{{ order.paymentStatus }}</span>
                          <button *ngIf="order.paymentStatus === 'Pending'" class="btn btn-sm btn-outline-primary" (click)="refreshOrderStatus(order.transactionID)">
                            {{ order.paymentStatus }} <i class="bi bi-arrow-repeat"></i>
                          </button>
                          <span *ngIf="order.paymentStatus === 'Failed'" class="badge bg-danger-transparent">{{ order.paymentStatus }}</span>
                        </td>
                        <td>
                          <span [ngClass]="'badge bg-' + getStatusClass(order.overallStatus)">
                            {{ order.overallStatus.toUpperCase() }}
                          </span>
                        </td>
                        <td>
                          <button *ngIf="order.paymentStatus === 'Failed'" class="btn btn-sm btn-outline-danger" (click)="sendNotification(order)">
                            <i class="fa fa-paper-plane"></i>
                          </button>
                          <button *ngIf="order.paymentStatus === 'Completed'" class="btn btn-sm btn-outline-success" (click)="processOrder(order)">
                            <i class="fa fa-pen"></i>
                          </button>
                          <button *ngIf="order.paymentStatus === 'Pending'" class="btn btn-sm btn-outline-primary" (click)="processOrder(order)">
                            <i class="fa fa-history"></i>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Pagination -->
                <nav aria-label="Page navigation mt-1">
                  <ul class="pagination">
                    <li class="page-item" [class.disabled]="currentPage === 1">
                      <a class="page-link" (click)="changePage('prev')">
                        <i class="bi bi-arrow-left"></i>
                      </a>
                    </li>
                    <li class="page-item" *ngFor="let page of pages" [class.active]="page === currentPage">
                      <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
                    </li>
                    <li class="page-item" [class.disabled]="currentPage === totalPages">
                      <a class="page-link" (click)="changePage('next')">
                        <i class="bi bi-arrow-right"></i>
                      </a>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </div>

  </div>
</div>




<button
  (click)="addProductToStore(activeStoreID)"
  mat-fab
  matTooltip="Add Products to Store"
>
  <mat-icon> add_circle_outline </mat-icon>
</button>



