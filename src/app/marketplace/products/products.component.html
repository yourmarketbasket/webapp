<div class="marketplace" #marketplace id="marketplace">
  
<!-- Section: Split screen within Carousel -->
<section>
  <div class="container-fluid px-3">
    <!-- Carousel component -->
    <mdb-carousel [indicators]="true" indicatorsColor="bg-secondary" [animation]="'fade'" [dark]="true" class="carousel-background rounded-2">
      <!-- particles -->
       <!-- the carousel -->
      <mdb-carousel-item *ngFor="let item of carouselProducts; let i = index" [interval]="2000">
        <!-- Card with three columns layout inside the carousel item -->
        <div class="w-100 h-100">
          <div class="row g-0 d-flex justify-content-between">
            <!-- First column for the image -->
            <div class="col-md-3">
              <img
                src="{{item.value[0].avatar[0]}}"
                alt="Trendy Pants and Shoes"
                class="img-fluid rounded-start w-100 shadow-5-strong"
                style="height: 300px; width: 100%;"
              />
            </div>

            <!-- Second column for the main content -->
            <div class="col-md-2 d-flex align-items-end">
              <div class="p-2 w-100 h-80 card flex-column justify-content-center align-items-center d-flex border-primary my-5 mx-1">
                <span class="fw-semibold">{{item.key.toUpperCase()}}</span>
                <small>Category: {{item.value[0].category}}</small>
                <small *ngIf="item.value[0].discount > 0">
                  Discount: {{item.value[0].discount}}%
                </small>
                <small>
                  Price: KES {{item.value[0].sp | currency: ' '}}
                </small>
                <div class="d-flex flex-column justify-content-center align-items-center">
                  <ng-template #t let-fill="fill">
                    <i class="bi-star-fill">
                      @if (fill > 0) {
                        <i class="bi-star-fill filled" [style.width.%]="fill"></i>
                      }
                    </i>
                  </ng-template>
                  
                  <ngb-rating [(rate)]="rating" [starTemplate]="t" [readonly]="true" [max]="5" [ariaValueText]="ariaValueText" />
                
                  <!-- View Product Button -->
                  <div class="d-flex d-row w-100 justify-content-between">
                    <button  class="btn btn-outline-success btn-floating">
                      <i-feather name="eye" class="small-icon"></i-feather>
                    </button>
                    <button  class="btn btn-outline-primary btn-floating">
                      <i-feather name="heart" class="small-icon"></i-feather>
                    </button>
                    <button  class="btn btn-outline-info btn-floating">
                      <i-feather name="shopping-cart" class="small-icon"></i-feather>
                    </button>
                  </div>
                </div>
                
              </div>
            </div>

            <!-- Third column for additional content or more details -->
            <div class="col-md-6">
              <div class="p-2 d-flex flex-column justify-content-center h-100 align-items-center text-primary">
                <h5 class="d-flex flex-row w-100 justify-content-center align-items-center">
                  Shop
                  with Convinience
                </h5>
                <div class="d-flex flex-row">
                  <span>Pay with M-PESA, VISA, MasterCard, American Express and Airtel Money</span>
                </div>
                <div class="d-flex flex-row justify-content-center paymentmethod-icons">
                  <img
                    style="width: 100px"
                    src="https://brand.mastercard.com/content/dam/mccom/brandcenter/thumbnails/mc_dla_symbol_92.png"
                    alt=""
                  />
                  <img
                    style="width: 100px"
                    src="https://www.logo.wine/a/logo/Visa_Inc./Visa_Inc.-Logo.wine.svg"
                    alt=""
                  />
                  <img
                    style="width: 100px"
                    src="https://www.safaricom.co.ke/images/MicrosoftTeams-image.jpg"
                    alt=""
                  />
                  <img
                    style="width: 100px"
                    src="https://www.logo.wine/a/logo/American_Express/American_Express-Logo.wine.svg"
                    alt=""
                  />
                  <img
                    style="width: 100px"
                    src="https://www.logo.wine/a/logo/Bharti_Airtel/Bharti_Airtel-Logo.wine.svg"
                    alt=""
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </mdb-carousel-item>
    </mdb-carousel>
  </div>
</section>
<!-- End of split screen section -->



  <mat-divider style="margin-top: 2%; margin-bottom: 1%"></mat-divider>
  <!--display  -->
  <div class="features" style="display: flex; justify-content: space-around">
    <p>
      <span nz-icon nzType="appstore" nzTheme="outline"></span> Trusted by More
      than {{ carouselData.brands.length }} Brands
    </p>
    <p>
      <span nz-icon nzType="line-chart" nzTheme="outline"></span> Offering More
      than {{ carouselData.categories.length }} categories
    </p>
    <p>
      <span nz-icon nzType="check-circle" nzTheme="outline"></span> And more
      than {{ carouselData.subcategories.length }} subcategories
    </p>
    <p>
      <span nz-icon nzType="home" nzTheme="outline"></span> Get your shopping
      delivered to your location
    </p>
  </div>
  <mat-divider></mat-divider>

  <div class="container">   

    <div class="categoriessection" style="margin-bottom: 5px">
      <mat-divider *ngIf="numberOfResults > 0"></mat-divider>
      <h3 style="font-weight: 600" *ngIf="numberOfResults > 0">
        Query Results
      </h3>

      <div
        id="searchResults"
        #searchResults
        class="search-results"
        *ngIf="searchQuery"
      >
        <span *ngIf="numberOfResults > 0" class="search-term"
          >Your query
          <span style="color: green">"{{ searchQuery }}"</span> returned
          <span style="color: green">{{ numberOfResults }}</span> results</span
        >
        <span *ngIf="numberOfResults == 0" class="search-term" style="color:rgb(235, 85, 110)"
          >No Products found for Search Phrase "{{ searchQuery }}"</span
        >
        <div
          class="allproductslisting"
          *ngIf="searchproductsloading"
          style="
            width: 100%;
            height: auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
          "
        >
          <mat-spinner *ngIf="searchproductsloading && numberOfResults !==0" strokeWidth="1"></mat-spinner>
        </div>
        <div class="allproductslisting" *ngIf="!searchproductsloading">
          <div
              (click)="viewProduct(product)"
              class="allproductlistingitem"
              *ngFor="let product of searchedProduct.slice((currentPage - 1) * productItemsPerPage, currentPage * productItemsPerPage)"
              (ngOnInit)="startImageLoop(product.id, product.avatar)"
            >
              <small>{{ product.brand.toUpperCase() }}</small>
              
              <!-- Looping through the product images -->
              <img 
                [src]="product.avatar[imageLoopData[product._id]?.currentImageIndex || 0]" 
                alt="Product Image" 
              />
              
              <small><strong>{{ product.name.toUpperCase() }}</strong></small>

              <small *ngIf="product.views[0]" style="color: rgb(174, 174, 174); font-size: 10">
                <mat-icon style="vertical-align: middle; transform: scale(0.7)">visibility</mat-icon>
                {{ convertNumberToShortScale(product.views[0].totalViews) }}({{ product.views[0].users.length }})
              </small>

              <div style="display: flex; flex-direction: row; justify-content: center; flex: 1 1 auto;">
                <small><s *ngIf="product.discount">Was {{ convertNumberToShortScale(product.sp) }}</s></small>
                <small>Now KES.{{ convertNumberToShortScale(product.sp, product.discount) }}</small>
              </div>

              <div *ngIf="product.discount" class="discountdot">
                <small>-{{ product.discount }}%</small>
              </div>
              
              <div class="stars">
                <mat-icon *ngFor="let i of range(rating)" style="transform: scale(0.6); color: white;">star</mat-icon>
                <mat-icon *ngIf="rating % 1 > 0" style="transform: scale(0.6); color: white">star_half</mat-icon>
                <mat-icon *ngFor="let i of range(5 - rating)" style="transform: scale(0.6); color: white">star_border</mat-icon>
              </div>
            </div>

        </div>
        <div class="allproductspagination" *ngIf="numberOfResults !==0">
          <button
            mat-stroked-button
            *ngFor="let page of getPageRange()"
            (click)="setPage(page)"
          >
            {{ page }}
          </button>
        </div>
      </div>
      <span class="fw-semibold" >All Products({{ products.length }})</span>
      <div
        *ngIf="allproductsloading"
        class="allproductslisting"
        style="
          width: 100%;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
        "
      >
        <mat-spinner strokeWidth="1"></mat-spinner>
      </div>
      <div *ngIf="!allproductsloading" class="allproductslisting">
        <div
          (click)="viewProduct(product)"
          class="allproductlistingitem"
          *ngFor="
            let product of products.slice(
              (currentPage - 1) * productItemsPerPage,
              currentPage * productItemsPerPage
            )
          "
        >
        <small>{{ product.brand.toUpperCase() }}</small>
              
        <!-- Looping through the product images -->
        <img 
          [src]="product.avatar[imageLoopData[product._id]?.currentImageIndex || 0]" 
          alt="Product Image" 
        />
        
        <small><strong>{{ product.name.toUpperCase() }}</strong></small>

        <small *ngIf="product.views[0]" style="color: rgb(174, 174, 174); font-size: 10">
          <mat-icon style="vertical-align: middle; transform: scale(0.7)">visibility</mat-icon>
          {{ convertNumberToShortScale(product.views[0].totalViews) }}({{ product.views[0].users.length }})
        </small>

        <div style="display: flex; flex-direction: row; justify-content: center; flex: 1 1 auto;">
          <small><s *ngIf="product.discount">Was {{ convertNumberToShortScale(product.sp) }}</s></small>
          <small>Now KES.{{ convertNumberToShortScale(product.sp, product.discount) }}</small>
        </div>

        <div *ngIf="product.discount" class="discountdot">
          <small>-{{ product.discount }}%</small>
        </div>
        
        <div class="stars">
          <mat-icon *ngFor="let i of range(rating)" style="transform: scale(0.6); color: white;">star</mat-icon>
          <mat-icon *ngIf="rating % 1 > 0" style="transform: scale(0.6); color: white">star_half</mat-icon>
          <mat-icon *ngFor="let i of range(5 - rating)" style="transform: scale(0.6); color: white">star_border</mat-icon>
        </div>
        </div>
      </div>
      <div class="allproductspagination">
        <button
          mat-stroked-button
          *ngFor="let page of getPageRange()"
          (click)="setPage(page)"
        >
          {{ page }}
        </button>
      </div>
    </div>
  </div>
</div>
